{% set moduleName = 'u4m-animated-stats' %}

{% include "../partials/u4-module-includes.html" %}


<div class="page-center {{ module.module_settings.theme }} {{ module.module_overrides.container_size }}">

	{{macros.introGroup(module.intro_content, module.module_settings)}}
	<div class="animated_stats_wrapper">
		<div class="stats_inner">
			<div class="flex_row">
				{% if module.stats_items.left_column.embed_url.href|escape_url or module.stats_items.left_column.embed_text %}
				<div class="stats_left col col4">
					<div class="embed_url">
						<div class="video-wrapper">
							<iframe loading="lazy" src="{{ module.stats_items.left_column.embed_url.href|escape_url }}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="" name="fitvid0"></iframe>

						</div>
					</div>
					<div class="embed_text">
						<div class="promo_description">
							<div>
								{{ module.stats_items.left_column.embed_text }}
							</div>
						</div>
					</div>
				</div>
				{% endif %}
				{% for item in module.stats_items.right_column %}
				<div class="stats_right col col4">

					<div class="number_count">
						<p>
							{% if item.prefix %}
							<span class="prefix">{{ item.prefix }}</span>
							{% endif %}
							<span class="count" data-count="{{ item.number }}">0</span>
							{% if item.surfix %}
							<span class="surfix">{{ item.surfix }}</span>
							{% endif %}
						</p>
					</div>
					<h5 class="title">{{ item.title }}</h5>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>
</div>
</section>


{# button group popup modal#}
{% if module.intro_content.include_button %}
{{macros.buttonGroup(module.intro_content.button_group, true)}}
{% endif %}




{% require_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
		// Function to start the counting animation
		function startCountingAnimation() {
			var counters = document.querySelectorAll('.u4m-animated-stats.{{name}} .count');
			counters.forEach(function(counter) {
				var countTo = counter.getAttribute('data-count');
				animateCounting(counter, countTo);
			});
		}

		// Function to animate counting and format the number with separators
		function animateCounting(counter, countTo) {
			let currentCount = parseInt(counter.textContent, 10) || 0;
			let targetCount = parseInt(countTo, 10);
			let duration = 1000;
			let startTime = null;

			function step(timestamp) {
				if (!startTime) startTime = timestamp;
				let progress = timestamp - startTime;
				let increment = Math.min(targetCount, currentCount + (targetCount - currentCount) * (progress / duration));

				counter.textContent = formatNumber(Math.floor(increment));

				if (progress < duration) {
					window.requestAnimationFrame(step);
				} else {
					counter.textContent = formatNumber(targetCount);
				}
			}

			window.requestAnimationFrame(step);
		}

		// Function to format numbers with commas
		function formatNumber(number) {
			return number.toLocaleString();
		}

		// Intersection Observer setup
		var observerOptions = {
			root: null, // Use the viewport as the root
			rootMargin: '0px',
			threshold: 0.1 // Trigger when 10% of the element is visible
		};

		var observer = new IntersectionObserver(function(entries) {
			entries.forEach(function(entry) {
				if (entry.isIntersecting) {
					// Start animation when the element is in view
					startCountingAnimation();
					// Optional: Unobserve after animation starts if only needed once
					observer.unobserve(entry.target);
				}
			});
		}, observerOptions);

		// Observe the .animated_stats_wrapper element
		document.querySelectorAll('.u4m-animated-stats.{{name}} .animated_stats_wrapper').forEach(function(wrapper) {
			observer.observe(wrapper);
		});
	});

</script>
{% end_require_js %}

